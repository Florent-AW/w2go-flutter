# 📱 Système de Bottom Bars - Documentation Technique

## 📋 Vue d'ensemble

Le système de bottom bars de l'application suit une architecture **Atomic Design** stricte, permettant une réutilisabilité maximale et une cohérence visuelle parfaite entre toutes les bottom bars de l'application.

### 🎯 Objectifs atteints
- ✅ **Architecture modulaire** - Composants réutilisables par niveau
- ✅ **Cohérence visuelle** - Même hauteur et style sur toutes les pages
- ✅ **Flexibilité** - Support de différents types de contenus
- ✅ **Performance** - États de loading intégrés
- ✅ **Maintenabilité** - Séparation claire des responsabilités

---

## 📁 Architecture des fichiers

### 🔧 Core Components (Atoms & Molecules)

#### `lib/core/theme/components/atoms/bottom_bar_container.dart`
**Atom UI** - Container de base pour toutes les bottom bars

```dart
// Features :
// - Padding et ombres standardisés
// - SafeArea automatique
// - Couleur de fond adaptative au thème
// - Personnalisation via paramètres optionnels
```

#### `lib/core/theme/components/atoms/action_button.dart`
**Atom UI** - Bouton standardisé pour toutes les bottom bars

```dart
// Features :
// - Icône + texte vertical
// - Effet ripple optimisé et centré
// - États enabled/disabled automatiques
// - Taille et padding normalisés
```

#### `lib/core/theme/components/molecules/bottom_bar_wrapper.dart`
**Molecule** - Combine BottomBarContainer + logique d'état

```dart
// Features :
// - États loading, error, content
// - Skeleton automatique pour loading
// - Utilise BottomBarContainer comme base
// - Padding horizontal supprimé pour full-width
```

### 🎨 Shared UI Components

#### `lib/features/shared_ui/presentation/widgets/molecules/navigation_buttons_row.dart`
**Molecule** - Boutons de navigation principale (4 tabs)

```dart
// Features :
// - Enum BottomNavTab (explorer, favoris, lyra, profil)
// - Indicateur 3px accent au-dessus du tab actif
// - Espacement précis : moitié-espace | bouton | espace | bouton...
// - Utilise ActionButton pour cohérence
```

#### `lib/features/shared_ui/presentation/widgets/organisms/generic_bottom_bar.dart`
**Organisme** - Bottom bar générique de navigation

```dart
// Features :
// - Combine BottomBarWrapper + NavigationButtonsRow
// - Export de BottomNavTab pour les templates
// - États loading intégrés
// - Callback onTabSelected pour navigation
```

### 🏗️ Feature-Specific Components

#### `lib/features/activity_detail/presentation/molecules/action_buttons_row.dart`
**Molecule** - Boutons spécifiques aux détails d'activité

```dart
// Features :
// - 3 boutons : Maps/Navigation, Téléphone, Site web
// - Utilise ActionButton pour cohérence de hauteur
// - Import du core/theme pour ActionButton
// - Logique métier intégrée (ExternalLauncherService)
```

#### `lib/features/activity_detail/presentation/organisms/floating_action_bar.dart`
**Organisme** - Bottom bar spécialisée pour les détails d'activité

```dart
// Features :
// - Utilise BottomBarWrapper (pas GenericBottomBar)
// - Intègre ActionButtonsRow pour les actions spécifiques
// - États Riverpod : loading, error, loaded
// - Hauteur identique à GenericBottomBar grâce à ActionButton
```

---

## 🚀 Utilisation

### Navigation générale
```dart
// Dans CategoryPageTemplate
bottomNavigationBar: GenericBottomBar(
  selectedTab: BottomNavTab.explorer,
  onTabSelected: (tab) {
    // Navigation vers les autres sections
    Navigator.pushNamed(context, tab.route);
  },
),
```

### Actions spécifiques
```dart
// Dans ActivityDetailPage
bottomNavigationBar: FloatingActionBar(
  activityId: widget.activityId,
),
```

### Custom bottom bar
```dart
// Nouvelle feature
bottomNavigationBar: BottomBarWrapper(
  content: CustomButtonsRow(
    // Utiliser ActionButton pour cohérence
  ),
),
```

---

## 🔧 Principes de design

### Atomic Design respecté
```
Atoms (bottom_bar_container, action_button)
    ↓
Molecules (bottom_bar_wrapper, navigation_buttons_row)
    ↓
Organisms (generic_bottom_bar, floating_action_bar)
    ↓
Templates (category_page_template)
```

### Cohérence visuelle garantie
- **Hauteur identique** : ActionButton normalise toutes les hauteurs
- **Padding standardisé** : BottomBarWrapper gère l'espacement
- **États cohérents** : Loading, error, content partout
- **Espacement précis** : Calculs mathématiques pour l'alignement

### Performance optimisée
- **RepaintBoundary** automatique sur les boutons
- **États de loading** avec skeleton standardisé
- **SafeArea** géré automatiquement

---

## ➕ Ajouter une nouvelle bottom bar

### 1. Créer la molecule des boutons
```dart
// lib/features/ma_feature/presentation/widgets/molecules/ma_buttons_row.dart
class MaButtonsRow extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Row(
      children: [
        Expanded(
          child: ActionButton( // ✅ Utiliser ActionButton
            icon: Icons.my_icon,
            label: 'Mon Action',
            onPressed: () => _onAction(),
          ),
        ),
        // ... autres boutons
      ],
    );
  }
}
```

### 2. Créer l'organisme
```dart
// lib/features/ma_feature/presentation/widgets/organisms/ma_bottom_bar.dart
class MaBottomBar extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return BottomBarWrapper( // ✅ Utiliser BottomBarWrapper
      content: MaButtonsRow(),
      isLoading: false,
    );
  }
}
```

### 3. Intégrer dans la page
```dart
// Dans le Scaffold
bottomNavigationBar: MaBottomBar(),
```

---

## 🎨 Customisation

### Modifier l'apparence globale
```dart
// Dans bottom_bar_container.dart
const defaultShadows = [
  BoxShadow(
    color: Colors.black12,
    blurRadius: 8,
    offset: Offset(0, -1),
  ),
];
```

### Ajouter un nouveau type de navigation
```dart
// Dans navigation_buttons_row.dart
enum BottomNavTab { 
  explorer, favoris, lyra, profil, 
  nouveauTab // ✅ Ajouter ici
}
```

### Modifier l'indicateur
```dart
// Dans navigation_buttons_row.dart
Container(
  height: 4, // ✅ Modifier l'épaisseur
  color: isSelected ? AppColors.primary : Colors.transparent, // ✅ Modifier la couleur
)
```

---

## ⚠️ Règles importantes

1. **TOUJOURS utiliser ActionButton** pour les boutons de bottom bar
2. **JAMAIS importer de molecule** dans une template (seulement organisms)
3. **TOUJOURS passer par BottomBarWrapper** pour les nouvelles bottom bars
4. **RESPECTER l'Atomic Design** : Atoms → Molecules → Organisms → Templates
5. **TESTER la cohérence de hauteur** entre toutes les bottom bars

---

## 🧪 Tests de cohérence

### Checklist validation
- [ ] Toutes les bottom bars ont la même hauteur
- [ ] L'effet ripple est centré sur tous les boutons
- [ ] Les états loading fonctionnent partout
- [ ] L'indicateur de navigation s'affiche correctement
- [ ] Pas de débordement horizontal sur aucun écran
- [ ] SafeArea respecté sur tous les devices

### Tests edge-cases
- ✅ Rotation écran (responsive)
- ✅ Très petits écrans
- ✅ Très grands écrans (tablets)
- ✅ Mode sombre/clair
- ✅ Accessibilité (TalkBack/VoiceOver)

---

Cette architecture garantit une évolutivité et une maintenabilité optimales du système de bottom bars de l'application ! 🚀